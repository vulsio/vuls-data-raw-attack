{
	"type": "relationship",
	"id": "relationship--a6bc65f9-30c8-4f55-b4ce-049afdb3255b",
	"created": "2022-03-30T14:26:51.857Z",
	"created_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
	"description": "Monitor processes and command-line arguments for actions that could be taken to change, conceal, and/or delete information in the Registry. (i.e. reg.exe, regedit.exe). The analytic is oriented around detecting invocations of [Reg](https://attack.mitre.org/software/S0075) where the parent executable is an instance of cmd.exe that wasn’t spawned by explorer.exe. The built-in utility reg.exe provides a command-line interface to the registry, so that queries and modifications can be performed from a shell, such as cmd.exe. When a user is responsible for these actions, the parent of cmd.exewill typically be explorer.exe. Occasionally, power users and administrators write scripts that do this behavior as well, but likely from a different process tree. These background scripts must be baselined so they can be tuned out accordingly. Analytic Event IDs are for Sysmon (Event ID 1 - process create) and Windows Security Log (Event ID 4688 - a new process has been created). \n\n<h4> Analytic 1 - Suspicious Processes </h4>\n<code>reg_processes = filter processes where ( \n  (event_id == \"1\" OR event_id == \"4688\") AND (exe == \"reg.exe\" AND parent_exe == \"cmd.exe\"))\ncmd_processes = filter processes where ( \n  (event_id == \"1\" OR event_id == \"4688\") AND (exe == \"cmd.exe\" AND parent_exe != \"explorer.exe\"\"))\nreg_and_cmd_processes = join (reg_processes, cmd_processes) where (reg.parent_pid == cmd.pid and reg.hostname == cmd.hostname)</code>\n\n<h4>Analytic 2 - Rare LolBAS Command Lines </h4>\n<code>lolbas_processes = filter processes where (\nexe = \"At.exe\" OR \nexe = \"Atbroker.exe\" OR \nexe = \"Bash.exe\" OR \nexe = \"Bitsadmin.exe\" OR \nexe = \"Certutil.exe\" OR \nexe = \"Cmd.exe\" OR \nexe = \"Cmdkey.exe\" OR \nexe = \"Cmstp.exe\" OR \nexe = \"Control.exe\" OR \nexe = \"Csc.exe\" OR \nexe = \"Cscript.exe\" OR \nexe = \"Dfsvc.exe\" OR \nexe = \"Diskshadow.exe\" OR \nexe = \"Dnscmd.exe\" OR \nexe = \"Esentutl.exe\" OR \nexe = \"Eventvwr.exe\" OR \nexe = \"Expand.exe\" OR \nexe = \"Extexport.exe\" OR \nexe = \"Extrac32.exe\" OR \nexe = \"Findstr.exe\" OR \nexe = \"Forfiles.exe\" OR \nexe = \"Ftp.exe\" OR \nexe = \"Gpscript.exe\" OR \nexe = \"Hh.exe\" OR \nexe = \"Ie4uinit.exe\" OR \nexe = \"Ieexec.exe\" OR \nexe = \"Infdefaultinstall.exe\" OR \nexe = \"Installutil.exe\" OR \nexe = \"Jsc.exe\" OR \nexe = \"Makecab.exe\" OR \nexe = \"Mavinject.exe\" OR \nexe = \"Microsoft.Workflow.r.exe\" OR \nexe = \"Mmc.exe\" OR \nexe = \"Msbuild.exe\" OR \nexe = \"Msconfig.exe\" OR \nexe = \"Msdt.exe\" OR \nexe = \"Mshta.exe\" OR \nexe = \"Msiexec.exe\" OR \nexe = \"Odbcconf.exe\" OR \nexe = \"Pcalua.exe\" OR \nexe = \"Pcwrun.exe\" OR \nexe = \"Presentationhost.exe\" OR\nexe = \"Print.exe\" OR \nexe = \"Reg.exe\" OR \nexe = \"Regasm.exe\" OR \nexe = \"Regedit.exe\" OR \nexe = \"Register-cimprovider.exe\" OR \nexe = \"Regsvcs.exe\" OR \nexe = \"Regsvr32.exe\" OR \nexe = \"Replace.exe\" OR \nexe = \"Rpcping.exe\" OR \nexe = \"Rundll32.exe\" OR \nexe = \"Runonce.exe\" OR \nexe = \"Runscripthelper.exe\" OR \nexe = \"Sc.exe\" OR \nexe = \"Schtasks.exe\" OR \nexe = \"Scriptrunner.exe\" OR \nexe = \"SyncAppvPublishingServer.exe\" OR \nexe = \"Tttracer.exe\" OR \nexe = \"Verclsid.exe\" OR \nexe = \"Wab.exe\" OR \nexe = \"Wmic.exe\" OR \nexe = \"Wscript.exe\" OR \nexe = \"Wsreset.exe\" OR \nexe = \"Xwizard.exe\" OR \nexe = \"Advpack.dll OR \nexe = \"Comsvcs.dll OR \nexe = \"Ieadvpack.dll OR \nexe = \"Ieaframe.dll OR \nexe = \"Mshtml.dll OR \nexe = \"Pcwutl.dll OR \nexe = \"Setupapi.dll OR \nexe = \"Shdocvw.dll OR \nexe = \"Shell32.dll OR \nexe = \"Syssetup.dll OR\nexe = \"Url.dll OR \nexe = \"Zipfldr.dll OR \nexe = \"Appvlp.exe\" OR \nexe = \"Bginfo.exe\" OR \nexe = \"Cdb.exe\" OR \nexe = \"csi.exe\" OR \nexe = \"Devtoolslauncher.exe\" OR \nexe = \"dnx.exe\" OR \nexe = \"Dxcap.exe\" OR \nexe = \"Excel.exe\" OR \nexe = \"Mftrace.exe\" OR \nexe = \"Msdeploy.exe\" OR \nexe = \"msxsl.exe\" OR \nexe = \"Powerpnt.exe\" OR \nexe = \"rcsi.exe\" OR \nexe = \"Sqler.exe\" OR \nexe = \"Sqlps.exe\" OR \nexe = \"SQLToolsPS.exe\" OR \nexe = \"Squirrel.exe\" OR \nexe = \"te.exe\" OR \nexe = \"Tracker.exe\" OR \nexe = \"Update.exe\" OR \nexe = \"vsjitdebugger.exe\" OR \nexe = \"Winword.exe\" OR \nexe = \"Wsl.exe\" OR \nexe = \"CL_Mutexverifiers.ps1 OR \nexe = \"CL_Invocation.ps1 OR \nexe = \"Manage-bde.wsf OR \nexe = \"Pubprn.vbs OR \nexe = \"Slmgr.vbs OR \nexe = \"Syncappvpublishingserver.vbs OR \nexe = \"winrm.vbs OR \nexe = \"Pester.bat)\nprocess_count = count(lolbas_processes) by process\nprocess_count_avg = average(process_count)\nprocess_count_stdev = standard_deviation(process_count)\nlower_bound = process_count_avg - stdev * 1.5\noutliers = filter lolbas_processes where (process_count < lower_bound) </code>",
	"modified": "2023-08-23T21:27:13.47Z",
	"object_marking_refs": [
		"marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168"
	],
	"relationship_type": "detects",
	"revoked": false,
	"source_ref": "x-mitre-data-component--3d20385b-24ef-40e1-9f56-f39750379077",
	"spec_version": "",
	"target_ref": "attack-pattern--57340c81-c025-4189-8fa0-fc7ede51bae4",
	"x_mitre_attack_spec_version": "3.1.0",
	"x_mitre_deprecated": false,
	"x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
	"x_mitre_version": "0.1"
}
